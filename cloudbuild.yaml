steps:
  # Clone from GitHub repo
  - name: gcr.io/cloud-builders/git
    args: ["clone", "https://github.com/lightcoker/CatchyPass.git"]
  # Build and push image
  - name: "gcr.io/cloud-builders/docker"
    args:
      ["build", "-t", "asia.gcr.io/catchypass/catchypass-server", "./server"]
  # Push container image
  - name: "gcr.io/cloud-builders/docker"
    args: ["push", "asia.gcr.io/catchypass/catchypass-server"]
  # deploy to GKE
  - name: "gcr.io/cloud-builders/gke-deploy"
    args:
      - run
      - --filename="./k8s/db/redis-deployment.yaml"
      - --image="asia.gcr.io/catchypass/catchypass-server"
      - --location=${_LOCATION}
      - --cluster=${_TESTING_CLUSTER}
images:
  - "asia.gcr.io/catchypass/catchypass-server"
